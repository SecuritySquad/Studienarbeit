\chapter{Konzept}

In diesem Kapitel werden das Gesamtkonzept und die Konzepte der einzelnen Tests vorgestellt. Das Gesamtkonzept umfasst die Einzelnen Komponenten von webifier und deren Zusammenspiel. Im Folgenden wird nun das Gesamtkonzept beschrieben.

\section{Gesamtkonzept}

\todo{Daniel}

\begin{itemize}
  \item Grafik
  \item Erklärung der Ergebnistypen
  \begin{itemize}
    \item unbedenklich (CLEAN)
    \item verdächtig (SUSPICIOUS)
    \item bedrohlich (MALICIOUS)
    \item unbekannt (UNDEFINED)
  \end{itemize}
\end{itemize}

\subsection{webifier Tests}
Webifier Tests ist der Oberbegriff für sämtliche von webifier durchgeführten Tests bei der Analyse einer Webseite. Wie bei der gesamten Anwendung wird auch bei den Tests viel Wert auf Modularität gelegt. Jeder Test bildet ein eigenständiges Bauteil, welches nach belieben integriert oder entfernt werden kann ohne Effekte auf die Lauffähigkeit der Gesamtanwendung.

Da webifier auf die Analyse von maliziösen Seiten ausgelegt ist gibt es bei den Tests einige Punkte zu beachten um das System vor Viren und Schadcode zu schützen.
Jeder Test wird in einer vom Gesamtsystem abgekapselten Laufzeitumgebung ausgeführt. Aus einem Test heraus darf nicht auf das System zugegriffen werden, da die Tests gegebenenfalls mit Schadcode befallen werden können durch das Erforschen von maliziösen Seiten. Es soll vermieden werden, dass sich Schadcode oder Viren von den Tests auf den Server verbreiten. Nach Durchlauf und Übermittelung des Ergebnisses löscht der Test sich selbst und alle Laufzeitdaten. Als Ergebnis werden keinerlei Dateien versendet, es beschränkt sich auf eine Weitergabe des Ergebnisses in Form einer Zeichenkette. Damit soll vermieden werden, dass sich eventuell mit Viren befallene Dateien weiter auf dem System ausbreiten können.

Ein Test liefert sein Ergebnis an den Tester, welcher dies dann im folgenden weiterverarbeitet.
Das Starten und Organisisieren der Tests wird von webifier Tester durchgeführt. Den Aufbau und die Funktionsweise des Testers wird im nächsten Abschnitt beschrieben.

Webifier stellt 9 verschiedene Tests um eine Webseite zu überprüfen. Das Konzept der einzelnen Test wird in jeweils eigenständigen Kapiteln erläutert. Hier folgt noch ein Überblick über die einzelnen Tests.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Test} & \textbf{Beschreibung} \\\hline
Virenscan der Webseite & Testet die Dateien einer Seite auf Viren \\\hline
Vergleich in verschiedenen Browsern & Test ob sich die Seite bei verschiedenen \\ & Browsern anders verhält \\\hline
Überprüfung der Port-Nutzung & Überprüft ob die Seite Portscanning betreibt \\\hline
Überprüfung der IP-Nutzung & Überprüft ob die Seite IPScanning betreibt \\\hline
Prüfung aller verlinkten Seiten & Testet die Links auf der Webseite gegen die \\ & Datenbank von webifier \\\hline
Google Safe Browsing & Nutzt die Google-API um die Webseite von \\ & Google testen zu lassen \\\hline
Überprüfung des SSL-Zertifikats & Überprüft das SSL-Zertifikat der Webseite \\\hline
Erkennung von Phishing & Testet ob es sich um eine Phishingseite handelt \\\hline
Screenshot der Seite & Gibt dem Nutzer einen Screenshot der Webseite \\\hline
\end{tabular}
\caption{Beschreibung der einzelnen Tests}
\label{tbl:tests}
\end{table}

\subsection{webifier Tester}

Der webifier Tester verwaltet alle Tests, führt diese aus und berechnet aus den einzelnen Ergebnissen der Tests ein Gesamtergebnis. Alle auszuführenden Tests werden in einer Konfigurationsdatei angegeben und können deshalb dynamisch angepasst werden. Da jeder Test in einem eigenen Prozess läuft wird beim Starten des Testers die Konfigurationsdatei geladen. Anschließend werden die einzelnen Tests ausgeführt und auf ein Ergebnis gewartet. Liegt von allen Tests das Ergebnis vor wird ein Gesamtergebis berechnet. Die Berechnung dieses Ergebnisses wird im Folgenden genauer erklärt.

Das Ergebnis kann entweder unbedenklich (\textit{CLEAN}), verdächtig (\textit{SUSPICIOUS}), bedrohlich (\textit{MALICIOUS}) oder unbekannt (\textit{UNDEFINED}) sein. Für die Berechnung des Endergebnisses erhält jeder Test wie in Tabelle \ref{tbl:test-weights} dargestellt eine Gewichtung, da einige Tests mehr über die Vertrauenswürdigkeit oder Gefahr einer Webseite aussagen als andere. Am meisten fallen der \textit{Virenscan der Webseite} und die \textit{Erkennung von Phishing} ins Gewicht, da dieses die ausschlaggebendsten Tests sind. Am wenigsten gewichtet sind der \textit{Vergleich in verschiedenen Browsern}, weil dies nur ein Indiz ist, da es auch viele Webseiten, wie die von YouTube, Nachrichtensendern, Blogs oder Ähnlichem gibt, welche immer dynamischen Inhalt bereitstellen und die \textit{Prüfung der verlinkten Seiten}, da dies immer vom Datenbestand abhängt. Der \textit{Screenshot der Seite} fällt nicht ins Gewicht, da dies kein Test im eigentlichen Sinne ist, sondern nur eine zusätzliche Information für den Nutzer darstellt. In Abschnitt \ref{sec:konzept-testarten} wird die Wahl der Gewichtungen für die einzelnen Tests noch ausführlicher erläutert.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Test} & \textbf{Gewichtung} & \textbf{Prozentuale Gewichtung} \\\hline
Virenscan der Webseite & 5 & \textasciitilde0,208\\\hline
Vergleich in verschiedenen Browsern & 1 & \textasciitilde0,042\\\hline
Überprüfung der Port-Nutzung & 3 & 0,125\\\hline
Überprüfung der IP-Nutzung & 3 & 0,125\\\hline
Prüfung aller verlinkten Seiten & 1 & \textasciitilde0,042\\\hline
Google Safe Browsing & 3 & 0,125\\\hline
Überprüfung des SSL-Zertifikats & 3 & 0,125\\\hline
Erkennung von Phishing & 5 & \textasciitilde0,208\\\hline
Screenshot der Seite & 0 & 0\\\hline
\end{tabular}
\caption{Gewichtungen der einzelnen Tests}
\label{tbl:test-weights}
\end{table}

Die prozentuale Gewichtung ergibt sich aus $\frac{Testgewichtung}{Summe~der~Gewichungen~aller~Tests}$.

Ein weiterer wichtiger Punkt, der für die Berechung ges Gesamtergebnisses festgelegt wurde ist, dass mindestens 50\% aller Tests (berechnet anhand der prozentualen Gewichtung) ein bekanntes Ergebnis, also \textit{CLEAN}, \textit{SUSPICIOUS} oder \textit{MALICIOUS} haben müssen. Ist der Anteil bekannter Ergebnisse kleiner lässt sich kein zuverlässiges Ergebnis berechnen, da dieses sonst von zu wenigen ausschlaggebenden Faktoren abhängen würde.

Liefern also mehr als die Hälfte der Tests ein bekanntes Ergebnis, so kann daraus nun das Gesamtergebnis berechnet werden. Hierfür wird für jedes Testergebnis ein Wert zwischen 0 und 1 berechnet, welcher anschließend mit der prozentualen Gewichtung des Tests multipliziert wird. Die Werte der einzelnen Testergebnisse ergeben sich wie in Tabelle \ref{tbl:test-values} dargestellt. Ist das Testergebnis \textit{CLEAN} oder \textit{UNDEFINED} ist der Ergebniswert 0 und geht so nicht weiter in die Wertung ein. Ist das Ergebnis \textit{MALICIOUS} wird der Wergebniswert 1. Dadurch Fällt das Gewicht dieses Tests voll in die Wertung. Ist das Ergebnis \textit{SUSPICIOUS} so wird die prozentuale Gewichtung des Tests als Ergebniswert gewählt. So fließt dieser Test mit dem Quadrat der Gewichtung in das Gesamtergebnis ein.

\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|l|}
\hline
\textbf{Testergebnis} & \textbf{Ergebniswert}\\\hline
\textit{CLEAN} & 0\\\hline
\textit{SUSPICIOUS} & Prozentuale Gewichtung des Tests\\\hline
\textit{MALICIOUS} & 1\\\hline
\textit{UNDEFINED} & 0\\\hline
\end{tabular}
\caption{Zuordnung Testergebnis zu Ergebniswert}
\label{tbl:test-values}
\end{table}

Anschließend werden die Werte aller Tests zu einem Endergebnis aufsummiert. Daraus ergibt sich im Gesamtergebnis ein Minimalwert von 0 und ein Maximalwert von 1. Dieser Wertebereich wird nun wie folgt auf die drei Ergebnisse \textit{CLEAN}, \textit{SUSPICIOUS} und \textit{MALICIOUS} verteilt. Die Tests mit der größten Gewichtung sollen hierbei ausschlaggebend sein. Daraus ergibt sich die prozentuale Gewichtung des Tests mit der größten Gewichtung als Minimalwert für \textit{MALICIOUS} und das Quadrat der prozentualen Gewichtung des Tests mit der größten Gewichtung als Minimalwert für \textit{SUSPICIOUS}.

Daraus lässt sich für die Werte der Tests aus Tabelle \ref{tbl:test-weights} die folgende Werteverteilung der Gesamtergebniswerte ableiten:

\begin{center}
$0 \leq CLEAN < 0,043402\overline{7} \leq SUSPICIOUS < 0,208\overline{3} \leq MALICIOUS \leq 1$
\end{center}

Zusätzlich zu dem berechneten Gesamtergebnis stellt der Tester auch alle Ergebnisse der Einzeltests und deren spezifischen Testinformationen bereit. Außerdem werden alle Ergebnisse zu Persistierung an das Modul webifier Data gesendet, welches in Abschnitt \ref{sec:konzept-data} genauer erläutert wird.

\subsection{webifier Plattform}

webifier Plattform ist eine Webanwendung, die auf den Tester aufsetzt und eine \ac{UI} für diesen zu Verfügung stellt. Außerdem bereitet sie die Ergebnisse des Testers grafisch für den Benutzer auf.

Der Nutzer hat die Möglichkeit auf der ersten Seite von webifier Plattform eine Url einzugeben, welche getestet werden soll. Da die Kapazität jedes Systems beschränkt ist verwaltet die Plattform alle Anfragen zur Webseitenüberprüfung in einer Warteschlange. In einer Konfigurationsdatei kan angegeben werden, wie viele Tests parallel ausgeführt werden sollen. So wird die Warteschlange nach und nach abgearbeit und anschließend werden die Ergebnisse des Testers für den Benutzer visuell aufbereitet. Das bereitgestellte Ergebnis umfasst zum Einen das Gesamtresultat, welches vom Tester berechnet wurde und zu Anderen sowohl die Ergebnisse der einzelen Tests, als auch die Zusätzlichen Informationen, welche von diesen bereitgestellt wurden.

So erhält der Nutzer einen umfassenden Bericht über die Vertrauenswürdigkeit oder die ausgehende Gefahr der überprüften Webseite.

\subsection{webifier Mail}

\todo{Daniel}

\subsection{webifier Data}
\label{sec:konzept-data}

\todo{Samuel}

\begin{itemize}
  \item Notwendige Informationen
  \item Datenmodell
\end{itemize}

\subsection{webifier Statistics}
Webifier Statistics ist die Statistikoberfläche von webifier. Hier werden alle Daten der analysierten Webseiten aufbereitet und in visueller Form dargestellt. Die Daten stammen aus den Ergebnissen aller Tests, welche von webifier Data abgespeichert wurden.

Webifier Statistics liefert dem Nutzer eine Vielzahl an verschiedenen Graphen, welche bestimmte Teilaspekte beleuchten. Diese enthalten zum Einen die Gesamtauswertungen, welche sich mit der allgemeinen Datenauswertung jedes Gesamttests beschäftigen. Zum Anderen gibt es noch die Einzelauswertungen der Tests, die testspezifische Ergebnisse auswerten.

Alle Auswertungen werden dem Nutzer über eine Weboberfläche zugänglich gemacht. Als Einstieg gibt es ein \textit{Dashboard} mit einigen Zahlen und Fakten zu den Aktivitäten auf webifier. Auf die einzelnen Auswertungen wird in der Auswertung genauer eingegangen.

\section{Testarten}
\label{sec:konzept-testarten}

\subsection{Virenscan der Webseite}

\todo{Samuel}

\begin{itemize}
  \item Httrack (Umsetzung)
  \item Download aller Dateien der Webseite
  \item Scannen der Heruntergeladenen Dateien
  \begin{itemize}
    \item Clamav (Umsetzung)
    \item AVG (Umsetzung)
    \item CAV (Umsetzung)
  \end{itemize}
\end{itemize}

\subsection{Vergleich in verschiedenen Browsern}

\todo{Daniel}

\subsection{Überprüfung der Port-Nutzung}
Der Test auf Port Scanning analysiert die Nutzung der Ports einer Webseite. Hierfür wird die Webseite automatisch vom Test geöffnet und dessen JavaScript ausgeführt. Parallel dazu muss die Netzwerkaktivität überwacht werden. Es werden alle eingehenden Anfragen auf das Testsystem zunächst geloggt. Da das Testsystem abgekapselt vom restlichen System ist, ist es irrelevant von welcher IP-Adresse die Anfragen kommen. Alle Anfragen lassen sich auf die aufgerufene Seite zurückführen, da restliche Netzwerkaktivität abgeschaltet ist. Dies ist wichtig, da es durchaus möglich ist das die Webseite nicht selbst einen Portscan-Angriff startet sondern beispielsweise über einen Drittrechner oder ein Botnetz gescannt wird. Zudem könnten die Ports auch lokal auf dem Client über JavaScript gescannt werden. Deshalb werden lediglich die angefragten Ports im Log gespeichert.

Nach erfolgreichem Durchschauen der Webseite beginnt die Analyse. Hier müssen alle Portanfragen klassifiziert werden. Es gibt eine Reihe von legitimen Portanfragen welche beispielsweise Port 80 für HTTP oder Port 443 für SSL sind. Diese Anfragen werden dann als harmlos markiert und somit ignoriert. Alle Anfragen, welche sich auf unspezifizierte Ports beziehen, werden als verdächtig markiert. Je nach Anzahl der verdächtigen Anfragen wird dann entschieden ob die Seite als bedrohlich, verdächtig oder sauber klassifiziert wird. Dieses Ergebnis wird dann mitsamt der gefundenen verdächtigen Portanfragen zurückgegeben.

\subsection{Überprüfung der IP-Nutzung}
Der Test auf IP Scanning beschäftigt sich mit der Analyse der IP-Anfragen, welche durch eine Webseite ausgelöst werden. Wie auch bereits bei Portscanning beschrieben wird die Webseite automatisch geöffnet und dessen JavaScript ausgeführt. Die Netzwerküberwachung hat hier jedoch einen anderen Fokus. Es werden die IPs der gesendeten Anfragen geloggt. Beim IP Scanning wird grundsätzlich versucht über die bekannten Heimnetz-IP-Netze weitere im Netzwerk angeschlossene Geräte zu erkennen um beispielsweise Viren auf dem gesamten Netzwerk zu verbreiten. Diese Angriffe werden über JavaScript auf dem Clienten gestartet. Deshalb werden die vom Clienten gesendeten Anfragen protokolliert. Hiervon werden lediglich die IPs gespeichert.

Nach dem Speichern aller IPs werden diese klassifiziert. Der Test vergleicht alle Anfragen mit den bekannten Heimnetz-IPs (beispielsweise 192.168.178.*). Anfragen, welche sich nicht auf diese Adressen zurückführen lassen werden herausgefiltert, da diese irrelevant für den Test sind. Anhand der Anzahl der verdächtigen Adressen wird im Abschluss wieder die Seite klassifiziert und das Ergebnis mitsamt den Adressen zurückgeliefert an den Tester.

\subsection{Prüfung aller verlinkten Seiten}

\todo{Daniel}

\begin{itemize}
  \item herausfiltern aller Links und nachgeladenen Ressourcen
  \item Schnittstelle in webifier-data
\end{itemize}

\subsection{Google Safe Browsing}

\todo{Daniel}

\subsection{Überprüfung des SSL-Zertifikats}

\todo{Samuel}

\begin{itemize}
  \item Auslesen der relevanten Informationen des Zertifikates der Webseite
  \item Validierung des Zertifikates
\end{itemize}

\subsection{Erkennung von Phishing}

\todo{Samuel}

\begin{itemize}
  \item Herausfiltern der Schlagwörter
  \item Finden möglicher Duplikate der Webseite
  \begin{itemize}
    \item Erstes Schlagwort zu Top Level Domains
    \begin{itemize}
      \item com
      \item ru
      \item net
      \item org
      \item de
    \end{itemize}
    \item Websuche nach den Schlagwörtern mittels Suchmaschinen
    \begin{itemize}
      \item DuckDuckGo
      \item Ixquick
      \item Bing
    \end{itemize}
  \end{itemize}
\end{itemize}

\subsection{Screenshot der Seite}
Der Screenshot-Test ist kein Test im eigentlichen Sinne. Er liefert keine Aussage über die Bedrohlichkeit einer Webseite. Deshalb liefert er immer als Ergebnis sauber und bleibt ungewichtet in der Gewichtung im Tester. Trotzdem wurde er mit implementiert um den Nutzern einen Blick auf die Seite zu geben, welche sie von webifier haben scannen lassen. Dies kann besonders interessant sein, da viele Nutzer auch daran interessiert sind wie die Seiten denn aussehen und was dort an Text oder Bilder zu sehen ist. Jedoch sollte keiner der Nutzer, auf eine als bedrohlich markierte Webseite, mit seinem Webbrowser zugreifen. Deshalb wird hier die Möglichkeit gegeben sich gefahrlos einmal die Webseite anzuschauen.
